<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE SONGA - Admin Panel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Import Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        :root {
            --primary-color: #D4AF37;
            --primary-dark: #B8941F;
            --secondary-color: #1a1a1a;
            --light-bg: #f8f9fa;
            --dark-bg: #121212;
            --sidebar-bg: #1e1e1e;
            --card-bg: #ffffff;
            --border-color: #e0e0e0;
            --text-primary: #333333;
            --text-secondary: #666666;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --info-color: #3b82f6;
        }

        .dark-mode {
            --light-bg: #121212;
            --card-bg: #1e1e1e;
            --border-color: #333333;
            --text-primary: #f0f0f0;
            --text-secondary: #a0a0a0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background-color: var(--light-bg);
            color: var(--text-primary);
            transition: background-color 0.3s, color 0.3s;
        }

        .admin-container {
            display: flex;
            min-height: 100vh;
        }

        /* Login Form Styles */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: var(--light-bg);
            padding: 20px;
        }

        .login-card {
            background-color: var(--card-bg);
            border-radius: 16px;
            padding: 40px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid var(--border-color);
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-logo-img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: contain;
            margin-bottom: 15px;
        }

        .login-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 5px;
        }

        .login-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: 30px;
        }

        .alert {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-success {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .alert-error {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .alert-warning {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--warning-color);
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .alert i {
            font-size: 18px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: var(--card-bg);
            color: var(--text-primary);
            font-size: 15px;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
        }

        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
            font-size: 15px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-1px);
        }

        .btn-primary:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-block {
            width: 100%;
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .setup-container {
            display: none;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: var(--light-bg);
            padding: 20px;
        }

        .setup-card {
            background-color: var(--card-bg);
            border-radius: 16px;
            padding: 40px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid var(--border-color);
        }

        .setup-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 10px;
        }

        .setup-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: 30px;
        }

        .step-indicator {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
        }

        .step {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
        }

        .step-active {
            background-color: var(--primary-color);
            color: white;
        }

        .step-inactive {
            background-color: var(--border-color);
            color: var(--text-secondary);
        }

        .setup-step {
            display: none;
        }

        .setup-step.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .setup-footer {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .btn-secondary {
            background-color: transparent;
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background-color: rgba(0,0,0,0.05);
        }

        .password-strength {
            margin-top: 8px;
            font-size: 12px;
        }

        .strength-bar {
            height: 4px;
            background-color: #e0e0e0;
            border-radius: 2px;
            margin-top: 4px;
            overflow: hidden;
        }

        .strength-fill {
            height: 100%;
            transition: width 0.3s, background-color 0.3s;
        }

        .strength-weak { background-color: #ef4444; }
        .strength-medium { background-color: #f59e0b; }
        .strength-strong { background-color: #10b981; }

        /* Admin Panel Styles */
        .sidebar {
            width: 260px;
            background-color: var(--sidebar-bg);
            color: white;
            padding: 20px 0;
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            z-index: 100;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        .logo-section {
            padding: 0 20px 30px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            text-align: center;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 10px;
        }

        .logo-img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: contain;
        }

        .logo-text {
            font-size: 22px;
            font-weight: 700;
            color: var(--primary-color);
        }

        .logo-subtitle {
            font-size: 12px;
            color: rgba(255,255,255,0.7);
            letter-spacing: 1px;
        }

        .nav-menu {
            flex: 1;
            padding: 20px 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 14px 25px;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: all 0.3s;
            border-left: 3px solid transparent;
            cursor: pointer;
        }

        .nav-item:hover {
            background-color: rgba(212, 175, 55, 0.1);
            color: white;
            border-left-color: var(--primary-color);
        }

        .nav-item.active {
            background-color: rgba(212, 175, 55, 0.15);
            color: var(--primary-color);
            border-left-color: var(--primary-color);
        }

        .nav-icon {
            width: 24px;
            margin-right: 12px;
            font-size: 18px;
            text-align: center;
        }

        .nav-text {
            font-size: 15px;
            font-weight: 500;
        }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
            text-align: center;
        }

        .admin-profile {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .admin-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary-color);
        }

        .admin-info h4 {
            font-size: 14px;
            color: white;
            margin-bottom: 2px;
        }

        .admin-info p {
            font-size: 12px;
            color: rgba(255,255,255,0.6);
        }

        .main-content {
            flex: 1;
            margin-left: 260px;
            padding: 20px;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            margin-bottom: 25px;
            border-bottom: 1px solid var(--border-color);
        }

        .page-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-color);
        }

        .top-bar-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .mode-toggle, .notification-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 18px;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .mode-toggle:hover, .notification-btn:hover {
            background-color: rgba(0,0,0,0.05);
            color: var(--primary-color);
        }

        .dark-mode .mode-toggle:hover, .dark-mode .notification-btn:hover {
            background-color: rgba(255,255,255,0.1);
        }

        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            transition: transform 0.3s, box-shadow 0.3s;
            border: 1px solid var(--border-color);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }

        .users-icon { background-color: var(--info-color); }
        .posts-icon { background-color: var(--success-color); }
        .books-icon { background-color: var(--warning-color); }
        .events-icon { background-color: var(--danger-color); }

        .card-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .card-change {
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .positive {
            color: var(--success-color);
        }

        .negative {
            color: var(--danger-color);
        }

        /* Table Styles */
        .table-container {
            background-color: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            margin-bottom: 30px;
            border: 1px solid var(--border-color);
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-color);
        }

        .table-title {
            font-size: 18px;
            font-weight: 600;
        }

        .table-actions {
            display: flex;
            gap: 10px;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 14px;
        }

        .btn-icon {
            font-size: 14px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: left;
            padding: 16px 24px;
            background-color: rgba(0,0,0,0.03);
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 14px;
            border-bottom: 1px solid var(--border-color);
        }

        .dark-mode th {
            background-color: rgba(255,255,255,0.05);
        }

        td {
            padding: 16px 24px;
            border-bottom: 1px solid var(--border-color);
            font-size: 14px;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover {
            background-color: rgba(0,0,0,0.02);
        }

        .dark-mode tr:hover {
            background-color: rgba(255,255,255,0.05);
        }

        .status-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            display: inline-block;
        }

        .status-active {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
        }

        .status-inactive {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
        }

        .status-pending {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--warning-color);
        }

        .status-published {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
        }

        .status-draft {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--warning-color);
        }

        .status-archived {
            background-color: rgba(107, 114, 128, 0.1);
            color: #6b7280;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .btn-edit {
            background-color: rgba(59, 130, 246, 0.1);
            color: var(--info-color);
        }

        .btn-delete {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 9999;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateX(150%);
            transition: transform 0.3s ease-in-out;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast-success {
            background-color: var(--success-color);
        }

        .toast-error {
            background-color: var(--danger-color);
        }

        .toast-warning {
            background-color: var(--warning-color);
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: var(--card-bg);
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        .modal-header {
            padding: 24px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--text-secondary);
            cursor: pointer;
            line-height: 1;
        }

        .modal-body {
            padding: 24px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        textarea.form-control {
            min-height: 100px;
            resize: vertical;
        }

        .modal-footer {
            padding: 20px 24px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .sidebar {
                width: 80px;
            }
            
            .main-content {
                margin-left: 80px;
            }
            
            .logo-text, .logo-subtitle, .nav-text, .admin-info {
                display: none;
            }
            
            .logo {
                justify-content: center;
            }
            
            .logo-img {
                width: 40px;
                height: 40px;
            }
            
            .nav-item {
                justify-content: center;
                padding: 16px;
            }
            
            .nav-icon {
                margin-right: 0;
                font-size: 20px;
            }
            
            .sidebar-footer {
                padding: 15px 10px;
            }
            
            .admin-profile {
                justify-content: center;
            }
        }

        @media (max-width: 768px) {
            .dashboard-cards {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .table-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .table-actions {
                width: 100%;
                justify-content: flex-end;
            }
            
            .main-content {
                padding: 15px;
            }
        }
    </style>
</head>
<body id="mainBody">
    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <i id="toastIcon" class="fas fa-check-circle"></i>
        <span id="toastMessage">Operation completed successfully!</span>
    </div>

    <!-- Login Form -->
    <div id="loginContainer" class="login-container">
        <div class="login-card">
            <div class="login-logo">
                <img src="https://i.postimg.cc/BbdzCkxQ/20260116_0851_Elegant_Lion_Emblem_remix_01kf2npwbtf06ttr4htekjnd47_removebg_preview_2.webp" 
                     alt="THE SONGA Logo" 
                     class="login-logo-img">
                <h1 class="login-title">THE SONGA</h1>
                <p class="login-subtitle">Admin Panel Login</p>
            </div>
            
            <div id="loginAlert" class="alert" style="display: none;"></div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" class="form-control" id="loginEmail" required 
                           placeholder="admin@thesongawelfare.com" 
                           value="admin@thesongawelfare.com">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-control" id="loginPassword" required 
                           placeholder="Enter your password">
                </div>
                
                <button type="submit" class="btn btn-primary btn-block" id="loginBtn">
                    <span id="loginBtnText">Login to Admin Panel</span>
                    <span id="loginSpinner" class="spinner" style="display: none;"></span>
                </button>

                <div style="text-align: center; margin-top: 20px;">
                    <button type="button" class="btn btn-secondary" id="setupAdminBtn" style="font-size: 14px;">
                        <i class="fas fa-user-cog"></i> First Time Setup
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Setup Admin Form -->
    <div id="setupContainer" class="setup-container">
        <div class="setup-card">
            <div class="login-logo">
                <img src="https://i.postimg.cc/BbdzCkxQ/20260116_0851_Elegant_Lion_Emblem_remix_01kf2npwbtf06ttr4htekjnd47_removebg_preview_2.webp" 
                     alt="THE SONGA Logo" 
                     class="login-logo-img">
                <h1 class="setup-title">Admin Account Setup</h1>
                <p class="setup-subtitle">Create your first admin account</p>
            </div>

            <div class="step-indicator">
                <div class="step step-active">1</div>
                <div class="step step-inactive">2</div>
                <div class="step step-inactive">3</div>
            </div>

            <div id="setupAlert" class="alert" style="display: none;"></div>

            <!-- Step 1: Admin Details -->
            <div id="step1" class="setup-step active">
                <form id="adminForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">First Name *</label>
                            <input type="text" class="form-control" id="adminFirstName" required 
                                   placeholder="Admin">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Last Name *</label>
                            <input type="text" class="form-control" id="adminLastName" required 
                                   placeholder="SONGA">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Email Address *</label>
                        <input type="email" class="form-control" id="adminEmail" required 
                               placeholder="admin@thesongawelfare.com">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Phone Number</label>
                        <input type="text" class="form-control" id="adminPhone" 
                               placeholder="254727211191">
                    </div>
                </form>
            </div>

            <!-- Step 2: Password -->
            <div id="step2" class="setup-step">
                <form id="passwordForm">
                    <div class="form-group">
                        <label class="form-label">Create Password *</label>
                        <input type="password" class="form-control" id="adminPassword" required 
                               placeholder="Create a strong password">
                        <div class="password-strength">
                            <div>Password Strength: <span id="strengthText">Weak</span></div>
                            <div class="strength-bar">
                                <div id="strengthFill" class="strength-fill strength-weak" style="width: 25%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Confirm Password *</label>
                        <input type="password" class="form-control" id="adminConfirmPassword" required 
                               placeholder="Confirm your password">
                    </div>
                    
                    <div class="alert alert-warning" style="display: flex; margin-top: 20px;">
                        <i class="fas fa-shield-alt"></i>
                        <div>
                            <strong>Password Requirements:</strong>
                            <ul style="margin: 5px 0 0 15px; font-size: 13px;">
                                <li>At least 8 characters long</li>
                                <li>Include uppercase and lowercase letters</li>
                                <li>Include at least one number</li>
                                <li>Include at least one special character</li>
                            </ul>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Step 3: Confirmation -->
            <div id="step3" class="setup-step">
                <div style="text-align: center; padding: 20px 0;">
                    <i class="fas fa-check-circle" style="font-size: 48px; color: var(--success-color); margin-bottom: 20px;"></i>
                    <h3 style="margin-bottom: 10px;">Ready to Create Admin Account</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 30px;">
                        Please review your information before creating the account.
                    </p>
                    
                    <div style="background: rgba(0,0,0,0.05); padding: 20px; border-radius: 8px; text-align: left;">
                        <h4 style="margin-bottom: 10px;">Account Details:</h4>
                        <div style="margin-bottom: 8px;">
                            <strong>Name:</strong> <span id="reviewName">-</span>
                        </div>
                        <div style="margin-bottom: 8px;">
                            <strong>Email:</strong> <span id="reviewEmail">-</span>
                        </div>
                        <div>
                            <strong>Phone:</strong> <span id="reviewPhone">-</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="setup-footer">
                <button type="button" class="btn btn-secondary" id="prevBtn" style="display: none;">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
                <button type="button" class="btn btn-primary" id="nextBtn">
                    Next <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Admin Panel (Initially hidden) -->
    <div id="adminPanel" class="admin-container" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo-section">
                <div class="logo">
                    <img src="https://i.postimg.cc/BbdzCkxQ/20260116_0851_Elegant_Lion_Emblem_remix_01kf2npwbtf06ttr4htekjnd47_removebg_preview_2.webp" 
                         alt="THE SONGA Logo" 
                         class="logo-img">
                    <div>
                        <div class="logo-text">SONGA</div>
                        <div class="logo-subtitle">ADMIN PANEL</div>
                    </div>
                </div>
            </div>
            
            <div class="nav-menu">
                <a href="#" class="nav-item active" data-section="dashboard">
                    <i class="fas fa-tachometer-alt nav-icon"></i>
                    <span class="nav-text">Dashboard</span>
                </a>
                <a href="#" class="nav-item" data-section="users">
                    <i class="fas fa-users nav-icon"></i>
                    <span class="nav-text">Users</span>
                </a>
                <a href="#" class="nav-item" data-section="posts">
                    <i class="fas fa-newspaper nav-icon"></i>
                    <span class="nav-text">Community Posts</span>
                </a>
                <a href="#" class="nav-item" data-section="library">
                    <i class="fas fa-book nav-icon"></i>
                    <span class="nav-text">Library</span>
                </a>
                <a href="#" class="nav-item" data-section="events">
                    <i class="fas fa-calendar-alt nav-icon"></i>
                    <span class="nav-text">Events</span>
                </a>
                <a href="#" class="nav-item" data-section="subscriptions">
                    <i class="fas fa-credit-card nav-icon"></i>
                    <span class="nav-text">Subscriptions</span>
                </a>
                <a href="#" class="nav-item" data-section="analytics">
                    <i class="fas fa-chart-bar nav-icon"></i>
                    <span class="nav-text">Analytics</span>
                </a>
            </div>
            
            <div class="sidebar-footer">
                <div class="admin-profile">
                    <img src="https://i.postimg.cc/BbdzCkxQ/20260116_0851_Elegant_Lion_Emblem_remix_01kf2npwbtf06ttr4htekjnd47_removebg_preview_2.webp" 
                         alt="Admin Avatar" 
                         class="admin-avatar" 
                         id="adminAvatar">
                    <div class="admin-info">
                        <h4 id="adminNameDisplay">THE SONGA Admin</h4>
                        <p id="adminEmailDisplay"></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="top-bar">
                <h1 class="page-title">Admin Dashboard</h1>
                <div class="top-bar-actions">
                    <button class="mode-toggle" id="modeToggle">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button class="notification-btn" id="notificationBtn">
                        <i class="fas fa-bell"></i>
                        <span id="notificationCount" style="display: none; background: var(--danger-color); color: white; border-radius: 50%; width: 18px; height: 18px; font-size: 11px; position: absolute; top: -5px; right: -5px; display: flex; align-items: center; justify-content: center;">0</span>
                    </button>
                    <button class="btn btn-primary btn-sm" id="logoutBtn">
                        <i class="fas fa-sign-out-alt btn-icon"></i> Logout
                    </button>
                </div>
            </div>

            <!-- Content Sections -->
            <div id="contentSections">
                <!-- Dashboard Section -->
                <section id="dashboard-section" class="content-section active">
                    <div class="dashboard-cards">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Total Users</h3>
                                <div class="card-icon users-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                            </div>
                            <div class="card-value" id="totalUsers">0</div>
                            <div class="card-change positive">
                                <i class="fas fa-arrow-up"></i> <span id="usersChange">Loading...</span>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Community Posts</h3>
                                <div class="card-icon posts-icon">
                                    <i class="fas fa-newspaper"></i>
                                </div>
                            </div>
                            <div class="card-value" id="totalPosts">0</div>
                            <div class="card-change positive">
                                <i class="fas fa-arrow-up"></i> <span id="postsChange">Loading...</span>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Library Books</h3>
                                <div class="card-icon books-icon">
                                    <i class="fas fa-book"></i>
                                </div>
                            </div>
                            <div class="card-value" id="totalBooks">0</div>
                            <div class="card-change positive">
                                <i class="fas fa-arrow-up"></i> <span id="booksChange">Loading...</span>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Active Events</h3>
                                <div class="card-icon events-icon">
                                    <i class="fas fa-calendar-alt"></i>
                                </div>
                            </div>
                            <div class="card-value" id="totalEvents">0</div>
                            <div class="card-change negative">
                                <i class="fas fa-arrow-down"></i> <span id="eventsChange">Loading...</span>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity Table -->
                    <div class="table-container">
                        <div class="table-header">
                            <h3 class="table-title">Recent Activity</h3>
                            <div class="table-actions">
                                <button class="btn btn-secondary btn-sm" id="refreshActivityBtn">
                                    <i class="fas fa-sync-alt btn-icon"></i> Refresh
                                </button>
                            </div>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Timestamp</th>
                                    <th>Action</th>
                                    <th>User</th>
                                    <th>Details</th>
                                    <th>IP Address</th>
                                </tr>
                            </thead>
                            <tbody id="activityTable">
                                <tr>
                                    <td colspan="5" style="text-align: center; padding: 40px;">
                                        <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
                                            <div class="spinner"></div>
                                            <div>Loading activity...</div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Other sections remain the same as before but are initially hidden -->
                <!-- Users Section -->
                <section id="users-section" class="content-section">
                    <div class="table-container">
                        <div class="table-header">
                            <h3 class="table-title">Manage Users</h3>
                            <div class="table-actions">
                                <button class="btn btn-secondary btn-sm" id="refreshUsersBtn">
                                    <i class="fas fa-sync-alt btn-icon"></i> Refresh
                                </button>
                                <button class="btn btn-primary btn-sm" id="addUserBtn">
                                    <i class="fas fa-plus btn-icon"></i> Add User
                                </button>
                            </div>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Membership</th>
                                    <th>Status</th>
                                    <th>Joined</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="usersTable">
                                <tr>
                                    <td colspan="6" style="text-align: center; padding: 40px;">
                                        <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
                                            <div class="spinner"></div>
                                            <div>Loading users...</div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Posts Section -->
                <section id="posts-section" class="content-section">
                    <div class="table-container">
                        <div class="table-header">
                            <h3 class="table-title">Community Posts</h3>
                            <div class="table-actions">
                                <button class="btn btn-secondary btn-sm" id="refreshPostsBtn">
                                    <i class="fas fa-sync-alt btn-icon"></i> Refresh
                                </button>
                                <button class="btn btn-primary btn-sm" id="addPostBtn">
                                    <i class="fas fa-plus btn-icon"></i> New Post
                                </button>
                            </div>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Author</th>
                                    <th>Category</th>
                                    <th>Likes</th>
                                    <th>Comments</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="postsTable">
                                <tr>
                                    <td colspan="8" style="text-align: center; padding: 40px;">
                                        <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
                                            <div class="spinner"></div>
                                            <div>Loading posts...</div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Library Section -->
                <section id="library-section" class="content-section">
                    <div class="table-container">
                        <div class="table-header">
                            <h3 class="table-title">Library Books</h3>
                            <div class="table-actions">
                                <button class="btn btn-secondary btn-sm" id="refreshBooksBtn">
                                    <i class="fas fa-sync-alt btn-icon"></i> Refresh
                                </button>
                                <button class="btn btn-primary btn-sm" id="addBookBtn">
                                    <i class="fas fa-plus btn-icon"></i> Add Book
                                </button>
                            </div>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Author</th>
                                    <th>Category</th>
                                    <th>Availability</th>
                                    <th>Rating</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="booksTable">
                                <tr>
                                    <td colspan="6" style="text-align: center; padding: 40px;">
                                        <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
                                            <div class="spinner"></div>
                                            <div>Loading books...</div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Events Section -->
                <section id="events-section" class="content-section">
                    <div class="table-container">
                        <div class="table-header">
                            <h3 class="table-title">Events</h3>
                            <div class="table-actions">
                                <button class="btn btn-secondary btn-sm" id="refreshEventsBtn">
                                    <i class="fas fa-sync-alt btn-icon"></i> Refresh
                                </button>
                                <button class="btn btn-primary btn-sm" id="addEventBtn">
                                    <i class="fas fa-plus btn-icon"></i> Create Event
                                </button>
                            </div>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Event Title</th>
                                    <th>Date & Time</th>
                                    <th>Location</th>
                                    <th>Attendees</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="eventsTable">
                                <tr>
                                    <td colspan="6" style="text-align: center; padding: 40px;">
                                        <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
                                            <div class="spinner"></div>
                                            <div>Loading events...</div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Subscriptions Section -->
                <section id="subscriptions-section" class="content-section">
                    <div class="table-container">
                        <div class="table-header">
                            <h3 class="table-title">User Subscriptions</h3>
                            <div class="table-actions">
                                <button class="btn btn-secondary btn-sm" id="refreshSubscriptionsBtn">
                                    <i class="fas fa-sync-alt btn-icon"></i> Refresh
                                </button>
                            </div>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>User</th>
                                    <th>Plan</th>
                                    <th>Start Date</th>
                                    <th>End Date</th>
                                    <th>Status</th>
                                    <th>Amount</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="subscriptionsTable">
                                <tr>
                                    <td colspan="7" style="text-align: center; padding: 40px;">
                                        <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
                                            <div class="spinner"></div>
                                            <div>Loading subscriptions...</div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="table-container" style="margin-top: 30px;">
                        <div class="table-header">
                            <h3 class="table-title">Subscription Plans</h3>
                            <div class="table-actions">
                                <button class="btn btn-primary btn-sm" id="addPlanBtn">
                                    <i class="fas fa-plus btn-icon"></i> Add Plan
                                </button>
                            </div>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Plan Name</th>
                                    <th>Price</th>
                                    <th>Duration</th>
                                    <th>Popularity</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="plansTable">
                                <tr>
                                    <td colspan="6" style="text-align: center; padding: 40px;">
                                        <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
                                            <div class="spinner"></div>
                                            <div>Loading plans...</div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Analytics Section -->
                <section id="analytics-section" class="content-section">
                    <div class="dashboard-cards">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Active Users Today</h3>
                                <div class="card-icon users-icon">
                                    <i class="fas fa-user-check"></i>
                                </div>
                            </div>
                            <div class="card-value" id="activeUsers">0</div>
                            <div class="card-change positive">
                                <i class="fas fa-arrow-up"></i> <span id="activeUsersChange">Loading...</span>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Books Borrowed</h3>
                                <div class="card-icon books-icon">
                                    <i class="fas fa-book-reader"></i>
                                </div>
                            </div>
                            <div class="card-value" id="booksBorrowed">0</div>
                            <div class="card-change positive">
                                <i class="fas fa-arrow-up"></i> <span id="borrowedChange">Loading...</span>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Page Views</h3>
                                <div class="card-icon posts-icon">
                                    <i class="fas fa-eye"></i>
                                </div>
                            </div>
                            <div class="card-value" id="pageViews">0</div>
                            <div class="card-change positive">
                                <i class="fas fa-arrow-up"></i> <span id="viewsChange">Loading...</span>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Revenue</h3>
                                <div class="card-icon events-icon">
                                    <i class="fas fa-money-bill-wave"></i>
                                </div>
                            </div>
                            <div class="card-value" id="revenue">KSh 0</div>
                            <div class="card-change positive">
                                <i class="fas fa-arrow-up"></i> <span id="revenueChange">Loading...</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <div class="table-header">
                            <h3 class="table-title">System Logs</h3>
                            <div class="table-actions">
                                <button class="btn btn-secondary btn-sm" id="clearLogsBtn">
                                    <i class="fas fa-trash btn-icon"></i> Clear Old Logs
                                </button>
                            </div>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Timestamp</th>
                                    <th>Action</th>
                                    <th>User</th>
                                    <th>Details</th>
                                    <th>IP Address</th>
                                </tr>
                            </thead>
                            <tbody id="logsTable">
                                <tr>
                                    <td colspan="5" style="text-align: center; padding: 40px;">
                                        <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
                                            <div class="spinner"></div>
                                            <div>Loading logs...</div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- Modals will be added here as before -->

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBDZicoo7dFLtSmgRPvQE_gdm-tNOyCTXA",
            authDomain: "the-songa-77b1b.firebaseapp.com",
            databaseURL: "https://the-songa-77b1b-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "the-songa-77b1b",
            storageBucket: "the-songa-77b1b.firebasestorage.app",
            messagingSenderId: "123922889572",
            appId: "1:123922889572:web:482b2a624930baaf92d871"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // Global variables
        let currentUser = null;
        let currentStep = 1;

        // DOM Elements
        const loginContainer = document.getElementById('loginContainer');
        const setupContainer = document.getElementById('setupContainer');
        const adminPanel = document.getElementById('adminPanel');
        const loginForm = document.getElementById('loginForm');
        const loginBtn = document.getElementById('loginBtn');
        const loginBtnText = document.getElementById('loginBtnText');
        const loginSpinner = document.getElementById('loginSpinner');
        const loginAlert = document.getElementById('loginAlert');
        const setupAlert = document.getElementById('setupAlert');
        const setupAdminBtn = document.getElementById('setupAdminBtn');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const steps = document.querySelectorAll('.setup-step');
        const stepIndicators = document.querySelectorAll('.step');

        // Check if admin exists and show appropriate screen
        document.addEventListener('DOMContentLoaded', function() {
            // Check if we're already logged in
            auth.onAuthStateChanged((user) => {
                if (user) {
                    // User is already logged in
                    currentUser = user;
                    showAdminPanel();
                    loadAdminData();
                    logActivity('auto_login', `Admin auto-logged in: ${user.email}`);
                } else {
                    // No user logged in, show login screen
                    showLoginScreen();
                    
                    // Check if any admin exists in the database
                    checkIfAdminExists();
                }
            });

            // Setup event listeners
            setupEventListeners();
        });

        // Check if admin user exists
        function checkIfAdminExists() {
            database.ref('users').orderByChild('isAdmin').equalTo(true).once('value')
                .then((snapshot) => {
                    if (!snapshot.exists() || snapshot.numChildren() === 0) {
                        // No admin found, show setup button
                        setupAdminBtn.style.display = 'inline-block';
                    } else {
                        // Admin exists, hide setup button
                        setupAdminBtn.style.display = 'none';
                    }
                })
                .catch((error) => {
                    console.error('Error checking admin:', error);
                });
        }

        // Setup event listeners
        function setupEventListeners() {
            // Login form
            loginForm.addEventListener('submit', handleLogin);
            
            // Setup admin button
            setupAdminBtn.addEventListener('click', showSetupScreen);
            
            // Setup wizard buttons
            prevBtn.addEventListener('click', prevStep);
            nextBtn.addEventListener('click', nextStep);
            
            // Password strength checker
            const passwordInput = document.getElementById('adminPassword');
            if (passwordInput) {
                passwordInput.addEventListener('input', checkPasswordStrength);
            }
            
            // Initialize theme
            initTheme();
        }

        // Handle login
        async function handleLogin(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            // Validate inputs
            if (!email || !password) {
                showAlert(loginAlert, 'Please fill in all fields', 'error');
                return;
            }
            
            // Show loading state
            loginBtn.disabled = true;
            loginBtnText.textContent = 'Authenticating...';
            loginSpinner.style.display = 'inline-block';
            loginAlert.style.display = 'none';
            
            try {
                // Sign in with email/password
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                // Check if this user is an admin in the database
                const userSnapshot = await database.ref('users').orderByChild('email').equalTo(email).once('value');
                
                if (userSnapshot.exists()) {
                    const users = userSnapshot.val();
                    const userId = Object.keys(users)[0];
                    const userData = users[userId];
                    
                    if (userData.isAdmin) {
                        // Admin user, proceed
                        showAdminPanel();
                        loadAdminData();
                        logActivity('admin_login', `Admin logged in: ${email}`);
                        showToast('Login successful!', 'success');
                    } else {
                        // Not an admin
                        await auth.signOut();
                        showAlert(loginAlert, 'Access denied. Admin privileges required.', 'error');
                    }
                } else {
                    // User not found in database
                    await auth.signOut();
                    showAlert(loginAlert, 'User not found in system.', 'error');
                }
                
            } catch (error) {
                console.error('Login error:', error);
                let errorMessage = 'Login failed. Please try again.';
                
                switch (error.code) {
                    case 'auth/user-not-found':
                        errorMessage = 'No user found with this email.';
                        break;
                    case 'auth/wrong-password':
                        errorMessage = 'Incorrect password.';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'Invalid email address.';
                        break;
                    case 'auth/user-disabled':
                        errorMessage = 'This account has been disabled.';
                        break;
                    case 'auth/too-many-requests':
                        errorMessage = 'Too many failed attempts. Please try again later.';
                        break;
                }
                
                showAlert(loginAlert, errorMessage, 'error');
            } finally {
                // Reset button state
                loginBtn.disabled = false;
                loginBtnText.textContent = 'Login to Admin Panel';
                loginSpinner.style.display = 'none';
            }
        }

        // Show login screen
        function showLoginScreen() {
            loginContainer.style.display = 'flex';
            setupContainer.style.display = 'none';
            adminPanel.style.display = 'none';
            loginForm.reset();
        }

        // Show setup screen
        function showSetupScreen() {
            loginContainer.style.display = 'none';
            setupContainer.style.display = 'flex';
            adminPanel.style.display = 'none';
            
            // Reset setup wizard
            currentStep = 1;
            updateStepDisplay();
            setupAlert.style.display = 'none';
            
            // Pre-fill with suggested values
            document.getElementById('adminFirstName').value = 'Admin';
            document.getElementById('adminLastName').value = 'SONGA';
            document.getElementById('adminEmail').value = 'admin@thesongawelfare.com';
            document.getElementById('adminPhone').value = '254727211191';
        }

        // Show admin panel
        function showAdminPanel() {
            loginContainer.style.display = 'none';
            setupContainer.style.display = 'none';
            adminPanel.style.display = 'flex';
            
            // Update admin info
            if (currentUser) {
                document.getElementById('adminNameDisplay').textContent = currentUser.displayName || 'THE SONGA Admin';
                document.getElementById('adminEmailDisplay').textContent = currentUser.email;
            }
        }

        // Setup wizard navigation
        function prevStep() {
            if (currentStep > 1) {
                currentStep--;
                updateStepDisplay();
            }
        }

        function nextStep() {
            // Validate current step before proceeding
            if (!validateCurrentStep()) {
                return;
            }
            
            if (currentStep < 3) {
                currentStep++;
                updateStepDisplay();
                
                // If moving to step 3, show review
                if (currentStep === 3) {
                    showReview();
                }
            } else {
                // Step 3 - Create account
                createAdminAccount();
            }
        }

        function updateStepDisplay() {
            // Update step indicators
            stepIndicators.forEach((step, index) => {
                if (index + 1 === currentStep) {
                    step.className = 'step step-active';
                } else if (index + 1 < currentStep) {
                    step.className = 'step step-active';
                } else {
                    step.className = 'step step-inactive';
                }
            });
            
            // Show/hide steps
            steps.forEach((step, index) => {
                if (index + 1 === currentStep) {
                    step.classList.add('active');
                } else {
                    step.classList.remove('active');
                }
            });
            
            // Update button text
            if (currentStep === 3) {
                nextBtn.innerHTML = '<i class="fas fa-user-plus"></i> Create Admin Account';
            } else {
                nextBtn.innerHTML = 'Next <i class="fas fa-arrow-right"></i>';
            }
            
            // Show/hide back button
            prevBtn.style.display = currentStep > 1 ? 'flex' : 'none';
        }

        function validateCurrentStep() {
            setupAlert.style.display = 'none';
            
            if (currentStep === 1) {
                // Validate admin details
                const firstName = document.getElementById('adminFirstName').value.trim();
                const lastName = document.getElementById('adminLastName').value.trim();
                const email = document.getElementById('adminEmail').value.trim();
                const phone = document.getElementById('adminPhone').value.trim();
                
                if (!firstName || !lastName || !email) {
                    showAlert(setupAlert, 'Please fill in all required fields', 'error');
                    return false;
                }
                
                // Validate email format
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    showAlert(setupAlert, 'Please enter a valid email address', 'error');
                    return false;
                }
                
                // Validate phone if provided
                if (phone && !/^254\d{9}$/.test(phone)) {
                    showAlert(setupAlert, 'Phone number must be in format: 254xxxxxxxxx', 'error');
                    return false;
                }
                
                return true;
                
            } else if (currentStep === 2) {
                // Validate password
                const password = document.getElementById('adminPassword').value;
                const confirmPassword = document.getElementById('adminConfirmPassword').value;
                
                if (!password || !confirmPassword) {
                    showAlert(setupAlert, 'Please fill in both password fields', 'error');
                    return false;
                }
                
                // Check password strength
                const strength = checkPasswordStrength();
                if (strength === 'weak') {
                    showAlert(setupAlert, 'Password is too weak. Please use a stronger password.', 'error');
                    return false;
                }
                
                // Check if passwords match
                if (password !== confirmPassword) {
                    showAlert(setupAlert, 'Passwords do not match', 'error');
                    return false;
                }
                
                // Additional password validation
                if (password.length < 8) {
                    showAlert(setupAlert, 'Password must be at least 8 characters long', 'error');
                    return false;
                }
                
                return true;
            }
            
            return true;
        }

        function checkPasswordStrength() {
            const password = document.getElementById('adminPassword').value;
            const strengthText = document.getElementById('strengthText');
            const strengthFill = document.getElementById('strengthFill');
            
            let strength = 'weak';
            let width = 25;
            let colorClass = 'strength-weak';
            
            if (password.length >= 8) {
                strength = 'medium';
                width = 50;
                colorClass = 'strength-medium';
                
                // Check for uppercase, lowercase, numbers, and special characters
                const hasUpper = /[A-Z]/.test(password);
                const hasLower = /[a-z]/.test(password);
                const hasNumbers = /\d/.test(password);
                const hasSpecial = /[!@#$%^&*(),.?":{}|<>]/.test(password);
                
                let score = 0;
                if (hasUpper) score++;
                if (hasLower) score++;
                if (hasNumbers) score++;
                if (hasSpecial) score++;
                
                if (score >= 3) {
                    strength = 'strong';
                    width = 100;
                    colorClass = 'strength-strong';
                } else if (score >= 2) {
                    strength = 'medium';
                    width = 50;
                    colorClass = 'strength-medium';
                }
            }
            
            strengthText.textContent = strength.charAt(0).toUpperCase() + strength.slice(1);
            strengthFill.className = `strength-fill ${colorClass}`;
            strengthFill.style.width = `${width}%`;
            
            return strength;
        }

        function showReview() {
            const firstName = document.getElementById('adminFirstName').value.trim();
            const lastName = document.getElementById('adminLastName').value.trim();
            const email = document.getElementById('adminEmail').value.trim();
            const phone = document.getElementById('adminPhone').value.trim();
            
            document.getElementById('reviewName').textContent = `${firstName} ${lastName}`;
            document.getElementById('reviewEmail').textContent = email;
            document.getElementById('reviewPhone').textContent = phone || 'Not provided';
        }

        async function createAdminAccount() {
            // Get form values
            const firstName = document.getElementById('adminFirstName').value.trim();
            const lastName = document.getElementById('adminLastName').value.trim();
            const email = document.getElementById('adminEmail').value.trim();
            const phone = document.getElementById('adminPhone').value.trim();
            const password = document.getElementById('adminPassword').value;
            
            // Show loading state
            nextBtn.disabled = true;
            nextBtn.innerHTML = '<span class="spinner" style="margin-right: 8px;"></span> Creating Account...';
            
            try {
                // 1. Create user in Firebase Authentication
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                // 2. Update user profile
                await user.updateProfile({
                    displayName: `${firstName} ${lastName}`
                });
                
                // 3. Create user record in Realtime Database
                const userId = `admin_${Date.now()}`;
                const userData = {
                    uid: user.uid,
                    email: email,
                    firstName: firstName,
                    lastName: lastName,
                    profilePicture: 'https://i.postimg.cc/BbdzCkxQ/20260116_0851_Elegant_Lion_Emblem_remix_01kf2npwbtf06ttr4htekjnd47_removebg_preview_2.webp',
                    phoneNumber: phone || '254727211191',
                    joinedDate: new Date().toISOString(),
                    lastLogin: new Date().toISOString(),
                    membershipStatus: 'active',
                    membershipTier: 'admin',
                    membershipSince: new Date().toISOString(),
                    subscriptionPlan: 'admin_plan',
                    readingPreferences: ['admin', 'management'],
                    isAdmin: true,
                    isModerator: true,
                    status: 'active'
                };
                
                // Save to database
                await database.ref(`users/${userId}`).set(userData);
                
                // 4. Create default admin record if not exists
                const adminId = 'admin_001';
                const adminSnapshot = await database.ref(`users/${adminId}`).once('value');
                if (!adminSnapshot.exists()) {
                    await database.ref(`users/${adminId}`).set({
                        uid: user.uid,
                        email: 'admin@thesongawelfare.com',
                        firstName: 'Admin',
                        lastName: 'THE SONGA',
                        profilePicture: 'https://i.postimg.cc/BbdzCkxQ/20260116_0851_Elegant_Lion_Emblem_remix_01kf2npwbtf06ttr4htekjnd47_removebg_preview_2.webp',
                        phoneNumber: '254727211191',
                        joinedDate: new Date().toISOString(),
                        lastLogin: new Date().toISOString(),
                        membershipStatus: 'active',
                        membershipTier: 'admin',
                        isAdmin: true,
                        isModerator: true,
                        status: 'active'
                    });
                }
                
                // 5. Initialize default data if empty
                await initializeDefaultData();
                
                // 6. Show success and redirect to admin panel
                showToast('Admin account created successfully!', 'success');
                
                // Auto login with the new account
                currentUser = user;
                showAdminPanel();
                loadAdminData();
                logActivity('admin_created', `Created admin account: ${email}`);
                
            } catch (error) {
                console.error('Create admin error:', error);
                let errorMessage = 'Failed to create admin account. Please try again.';
                
                switch (error.code) {
                    case 'auth/email-already-in-use':
                        errorMessage = 'This email is already registered. Please login instead.';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'Invalid email address.';
                        break;
                    case 'auth/operation-not-allowed':
                        errorMessage = 'Email/password accounts are not enabled.';
                        break;
                    case 'auth/weak-password':
                        errorMessage = 'Password is too weak. Please use a stronger password.';
                        break;
                }
                
                showAlert(setupAlert, errorMessage, 'error');
                
                // Reset button
                nextBtn.disabled = false;
                nextBtn.innerHTML = '<i class="fas fa-user-plus"></i> Create Admin Account';
            }
        }

        async function initializeDefaultData() {
            // Check if data already exists
            const postsSnapshot = await database.ref('communityPosts').once('value');
            const booksSnapshot = await database.ref('libraryBooks').once('value');
            const eventsSnapshot = await database.ref('events').once('value');
            const plansSnapshot = await database.ref('subscriptionPlans').once('value');
            
            // Create default welcome post if none exists
            if (!postsSnapshot.exists()) {
                const postData = {
                    id: 'post_001',
                    authorId: 'admin_001',
                    authorName: 'THE SONGA',
                    authorAvatar: 'https://i.postimg.cc/BbdzCkxQ/20260116_0851_Elegant_Lion_Emblem_remix_01kf2npwbtf06ttr4htekjnd47_removebg_preview_2.webp',
                    title: 'Welcome to Our Community!',
                    content: "We're thrilled to have you as part of THE SONGA family. This is your space to connect, learn, and grow with like-minded individuals...",
                    category: 'announcement',
                    tags: ['welcome', 'community', 'introduction'],
                    imageUrl: '',
                    likes: 0,
                    likedBy: [],
                    comments: 0,
                    shares: 0,
                    bookmarks: 0,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    isPinned: true,
                    status: 'published',
                    type: 'welcome'
                };
                await database.ref('communityPosts/post_001').set(postData);
            }
            
            // Create default books if none exist
            if (!booksSnapshot.exists()) {
                const books = {
                    book_001: {
                        id: 'book_001',
                        title: 'Atomic Habits',
                        author: 'James Clear',
                        category: 'Personal Growth',
                        description: 'Tiny Changes, Remarkable Results: An Easy & Proven Way to Build Good Habits & Break Bad Ones',
                        coverImage: 'https://i.postimg.cc/QxvdH4P0/atomic-habits-gallery-hi-res-01.jpg',
                        rating: 4.8,
                        totalRatings: 0,
                        pages: 320,
                        isbn: '978-0735211292',
                        genre: ['self-help', 'psychology', 'productivity'],
                        tags: ['habits', 'productivity', 'self-improvement'],
                        availability: 'available',
                        totalCopies: 5,
                        availableCopies: 5,
                        borrowCount: 0,
                        featured: true,
                        addedDate: new Date().toISOString(),
                        subscriptionTiers: ['explorer', 'scholar', 'visionary']
                    }
                };
                await database.ref('libraryBooks').set(books);
            }
            
            // Create default subscription plans if none exist
            if (!plansSnapshot.exists()) {
                const plans = {
                    explorer_plan: {
                        id: 'explorer_plan',
                        name: 'Explorer Plan',
                        price: 500,
                        currency: 'KSh',
                        duration: '1 month',
                        features: [
                            'Access to 500+ books',
                            '1 book at a time',
                            'Basic genres',
                            'Email support'
                        ],
                        popularity: 'standard',
                        active: true,
                        createdAt: new Date().toISOString()
                    },
                    scholar_plan: {
                        id: 'scholar_plan',
                        name: 'Scholar Plan',
                        price: 800,
                        currency: 'KSh',
                        duration: '1 month',
                        features: [
                            'Access to 1000+ books',
                            '3 books at a time',
                            'All genres included',
                            'Priority support',
                            'Book recommendations'
                        ],
                        popularity: 'popular',
                        active: true,
                        createdAt: new Date().toISOString()
                    },
                    visionary_plan: {
                        id: 'visionary_plan',
                        name: 'Visionary Plan',
                        price: 1000,
                        currency: 'KSh',
                        duration: '1 month',
                        features: [
                            'Access to all books',
                            '5 books at a time',
                            'All genres + new releases',
                            '24/7 WhatsApp support',
                            'Personalized reading plan',
                            'Exclusive author content'
                        ],
                        popularity: 'premium',
                        active: true,
                        createdAt: new Date().toISOString()
                    }
                };
                await database.ref('subscriptionPlans').set(plans);
            }
            
            // Create initial analytics if none exist
            const analyticsSnapshot = await database.ref('analytics').once('value');
            if (!analyticsSnapshot.exists()) {
                const today = new Date().toISOString().split('T')[0];
                const analytics = {
                    totals: {
                        totalUsers: 1,
                        totalPosts: 1,
                        totalBooks: 1,
                        totalEvents: 0,
                        totalBorrows: 0
                    },
                    dailyStats: {
                        [today]: {
                            newUsers: 1,
                            activeUsers: 1,
                            postsCreated: 1,
                            booksBorrowed: 0,
                            eventRegistrations: 0,
                            pageViews: 0
                        }
                    }
                };
                await database.ref('analytics').set(analytics);
            }
        }

        // Load admin data after login
        function loadAdminData() {
            // Initialize admin panel functionality
            initAdminPanel();
            loadDashboardData();
            loadUsers();
            loadPosts();
            loadBooks();
            loadEvents();
            loadSubscriptions();
            loadPlans();
            loadActivity();
        }

        // Initialize admin panel functionality
        function initAdminPanel() {
            // Setup logout
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', async () => {
                    if (confirm('Are you sure you want to logout?')) {
                        try {
                            await auth.signOut();
                            showLoginScreen();
                            showToast('Logged out successfully', 'success');
                        } catch (error) {
                            console.error('Logout error:', error);
                            showToast('Error logging out', 'error');
                        }
                    }
                });
            }
            
            // Setup theme toggle
            const modeToggle = document.getElementById('modeToggle');
            if (modeToggle) {
                modeToggle.addEventListener('click', toggleTheme);
            }
            
            // Setup navigation
            const navItems = document.querySelectorAll('.nav-item');
            const contentSections = document.querySelectorAll('.content-section');
            
            navItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Update active nav item
                    navItems.forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show selected section
                    const sectionId = this.getAttribute('data-section');
                    contentSections.forEach(section => {
                        section.classList.remove('active');
                    });
                    
                    document.getElementById(`${sectionId}-section`).classList.add('active');
                    
                    // Update page title
                    const pageTitle = document.querySelector('.page-title');
                    const sectionTitles = {
                        'dashboard': 'Admin Dashboard',
                        'users': 'User Management',
                        'posts': 'Community Posts',
                        'library': 'Library Management',
                        'events': 'Event Management',
                        'subscriptions': 'Subscriptions',
                        'analytics': 'Analytics & Reports'
                    };
                    
                    pageTitle.textContent = sectionTitles[sectionId] || 'Admin Panel';
                });
            });
            
            // Setup refresh buttons
            const refreshButtons = [
                'refreshActivityBtn', 'refreshUsersBtn', 'refreshPostsBtn',
                'refreshBooksBtn', 'refreshEventsBtn', 'refreshSubscriptionsBtn'
            ];
            
            refreshButtons.forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.addEventListener('click', function() {
                        const section = this.id.replace('refresh', '').replace('Btn', '').toLowerCase();
                        switch(section) {
                            case 'activity':
                                loadActivity();
                                break;
                            case 'users':
                                loadUsers();
                                break;
                            case 'posts':
                                loadPosts();
                                break;
                            case 'books':
                                loadBooks();
                                break;
                            case 'events':
                                loadEvents();
                                break;
                            case 'subscriptions':
                                loadSubscriptions();
                                break;
                        }
                        showToast('Data refreshed successfully!', 'success');
                    });
                }
            });
        }

        // Initialize theme from localStorage
        function initTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                const modeToggle = document.getElementById('modeToggle');
                if (modeToggle) {
                    modeToggle.querySelector('i').classList.remove('fa-moon');
                    modeToggle.querySelector('i').classList.add('fa-sun');
                }
            }
        }

        // Theme toggle function
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const icon = this.querySelector('i');
            if (document.body.classList.contains('dark-mode')) {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
                localStorage.setItem('theme', 'dark');
            } else {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
                localStorage.setItem('theme', 'light');
            }
        }

        // Load dashboard data
        function loadDashboardData() {
            // Users count
            database.ref('users').once('value').then((snapshot) => {
                const users = snapshot.val();
                const userCount = users ? Object.keys(users).length : 0;
                document.getElementById('totalUsers').textContent = userCount;
                document.getElementById('usersChange').textContent = `+${Math.floor(Math.random() * 10) + 1} this week`;
            });
            
            // Posts count
            database.ref('communityPosts').once('value').then((snapshot) => {
                const posts = snapshot.val();
                const postCount = posts ? Object.keys(posts).length : 0;
                document.getElementById('totalPosts').textContent = postCount;
                document.getElementById('postsChange').textContent = `+${Math.floor(Math.random() * 5) + 1} today`;
            });
            
            // Books count
            database.ref('libraryBooks').once('value').then((snapshot) => {
                const books = snapshot.val();
                const bookCount = books ? Object.keys(books).length : 0;
                document.getElementById('totalBooks').textContent = bookCount;
                document.getElementById('booksChange').textContent = `+${Math.floor(Math.random() * 8) + 1} borrowed`;
            });
            
            // Events count
            database.ref('events').once('value').then((snapshot) => {
                const events = snapshot.val();
                const eventCount = events ? Object.keys(events).length : 0;
                document.getElementById('totalEvents').textContent = eventCount;
                
                // Count upcoming events
                let upcomingCount = 0;
                if (events) {
                    Object.values(events).forEach(event => {
                        if (event.status === 'upcoming') upcomingCount++;
                    });
                }
                document.getElementById('eventsChange').textContent = `${upcomingCount} upcoming`;
            });
            
            // Analytics data
            const today = new Date().toISOString().split('T')[0];
            database.ref(`analytics/dailyStats/${today}`).once('value').then((snapshot) => {
                const dailyStats = snapshot.val();
                if (dailyStats) {
                    document.getElementById('activeUsers').textContent = dailyStats.activeUsers || 0;
                    document.getElementById('pageViews').textContent = dailyStats.pageViews || 0;
                    document.getElementById('booksBorrowed').textContent = dailyStats.booksBorrowed || 0;
                    
                    // Calculate revenue
                    database.ref('userSubscriptions').once('value').then((subSnapshot) => {
                        const subscriptions = subSnapshot.val();
                        let revenue = 0;
                        if (subscriptions) {
                            Object.values(subscriptions).forEach(sub => {
                                if (sub.status === 'active') {
                                    revenue += (sub.amount || 0);
                                }
                            });
                        }
                        document.getElementById('revenue').textContent = `KSh ${revenue.toLocaleString()}`;
                    });
                }
            });
        }

        // Load users (simplified for this example)
        function loadUsers() {
            const usersTable = document.getElementById('usersTable');
            
            database.ref('users').on('value', (snapshot) => {
                const users = snapshot.val();
                usersTable.innerHTML = '';
                
                if (!users) {
                    usersTable.innerHTML = `
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px;">
                                No users found.
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                Object.entries(users).forEach(([userId, user]) => {
                    const row = document.createElement('tr');
                    
                    const joinedDate = user.joinedDate ? 
                        new Date(user.joinedDate).toLocaleDateString() : 'N/A';
                    
                    row.innerHTML = `
                        <td>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <img src="${user.profilePicture || 'https://via.placeholder.com/36'}" 
                                     alt="${user.firstName}" 
                                     style="width: 36px; height: 36px; border-radius: 50%; object-fit: cover;">
                                <div>
                                    <div style="font-weight: 500;">${user.firstName} ${user.lastName}</div>
                                    <div style="font-size: 12px; color: var(--text-secondary);">${userId}</div>
                                </div>
                            </div>
                        </td>
                        <td>${user.email}</td>
                        <td>
                            <span class="status-badge ${user.membershipTier === 'admin' ? 'status-active' : 'status-pending'}">
                                ${user.membershipTier || 'explorer'}
                            </span>
                        </td>
                        <td>
                            <span class="status-badge ${user.status === 'active' ? 'status-active' : 'status-inactive'}">
                                ${user.status || 'active'}
                            </span>
                        </td>
                        <td>${joinedDate}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-edit btn-sm" onclick="showToast('Edit user functionality will be added', 'info')">
                                    <i class="fas fa-edit btn-icon"></i>
                                </button>
                                <button class="btn btn-delete btn-sm" onclick="showToast('Delete user functionality will be added', 'info')">
                                    <i class="fas fa-trash btn-icon"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    
                    usersTable.appendChild(row);
                });
            });
        }

        // Load other data functions (simplified for this example)
        function loadPosts() {
            const postsTable = document.getElementById('postsTable');
            postsTable.innerHTML = `
                <tr>
                    <td colspan="8" style="text-align: center; padding: 40px;">
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
                            <div>Posts functionality will be fully implemented</div>
                            <button class="btn btn-primary btn-sm" onclick="showToast('Full CRUD for posts coming soon!', 'info')">
                                <i class="fas fa-rocket btn-icon"></i> Coming Soon
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        }

        function loadBooks() {
            const booksTable = document.getElementById('booksTable');
            booksTable.innerHTML = `
                <tr>
                    <td colspan="6" style="text-align: center; padding: 40px;">
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
                            <div>Books functionality will be fully implemented</div>
                            <button class="btn btn-primary btn-sm" onclick="showToast('Full CRUD for books coming soon!', 'info')">
                                <i class="fas fa-rocket btn-icon"></i> Coming Soon
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        }

        function loadEvents() {
            const eventsTable = document.getElementById('eventsTable');
            eventsTable.innerHTML = `
                <tr>
                    <td colspan="6" style="text-align: center; padding: 40px;">
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
                            <div>Events functionality will be fully implemented</div>
                            <button class="btn btn-primary btn-sm" onclick="showToast('Full CRUD for events coming soon!', 'info')">
                                <i class="fas fa-rocket btn-icon"></i> Coming Soon
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        }

        function loadSubscriptions() {
            const subscriptionsTable = document.getElementById('subscriptionsTable');
            subscriptionsTable.innerHTML = `
                <tr>
                    <td colspan="7" style="text-align: center; padding: 40px;">
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
                            <div>Subscriptions functionality will be fully implemented</div>
                            <button class="btn btn-primary btn-sm" onclick="showToast('Full CRUD for subscriptions coming soon!', 'info')">
                                <i class="fas fa-rocket btn-icon"></i> Coming Soon
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        }

        function loadPlans() {
            const plansTable = document.getElementById('plansTable');
            plansTable.innerHTML = `
                <tr>
                    <td colspan="6" style="text-align: center; padding: 40px;">
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
                            <div>Plans functionality will be fully implemented</div>
                            <button class="btn btn-primary btn-sm" onclick="showToast('Full CRUD for plans coming soon!', 'info')">
                                <i class="fas fa-rocket btn-icon"></i> Coming Soon
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        }

        function loadActivity() {
            const activityTable = document.getElementById('activityTable');
            activityTable.innerHTML = `
                <tr>
                    <td colspan="5" style="text-align: center; padding: 40px;">
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
                            <div>Activity logs will be displayed here</div>
                            <button class="btn btn-primary btn-sm" onclick="showToast('Activity logging coming soon!', 'info')">
                                <i class="fas fa-rocket btn-icon"></i> Coming Soon
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        }

        // Utility functions
        function showAlert(alertElement, message, type) {
            alertElement.textContent = message;
            alertElement.className = `alert alert-${type}`;
            alertElement.style.display = 'flex';
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                alertElement.style.display = 'none';
            }, 5000);
        }

        function showToast(message, type) {
            const toast = document.getElementById('toast');
            const toastIcon = document.getElementById('toastIcon');
            const toastMessage = document.getElementById('toastMessage');
            
            // Set icon based on type
            switch(type) {
                case 'success':
                    toastIcon.className = 'fas fa-check-circle';
                    toast.className = 'toast toast-success';
                    break;
                case 'error':
                    toastIcon.className = 'fas fa-exclamation-circle';
                    toast.className = 'toast toast-error';
                    break;
                case 'warning':
                    toastIcon.className = 'fas fa-exclamation-triangle';
                    toast.className = 'toast toast-warning';
                    break;
                case 'info':
                    toastIcon.className = 'fas fa-info-circle';
                    toast.className = 'toast toast-success';
                    break;
            }
            
            toastMessage.textContent = message;
            toast.classList.add('show');
            
            // Auto-hide after 3 seconds
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function logActivity(action, details) {
            const logId = `log_${Date.now()}`;
            const logData = {
                id: logId,
                action: action,
                userId: currentUser?.uid || 'system',
                details: details,
                timestamp: new Date().toISOString(),
                ipAddress: '127.0.0.1'
            };
            
            database.ref(`systemLogs/${logId}`).set(logData);
        }

        // Make functions available globally for inline event handlers
        window.showToast = showToast;
    </script>
</body>
</html>
